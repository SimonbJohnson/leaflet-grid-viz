var lg={mapRegister:"",_gridRegister:[],_colors:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],_selectedBar:-1,init:function(){this.mapRegister.init(),this._gridRegister.forEach(function(t){t.init()})},colors:function(t){return"undefined"==typeof t?this._colors:(this._colors=t,this)},map:function(t){this._id=t,this._geojson="",this._center=[0,0],this._zoom=1,this._nameAttr="",this._joinAttr="",this._map="",this._info="",this._currentData=[],lg.mapRegister=this,this.geojson=function(t){return"undefined"==typeof t?this._geojson:(this._geojson=t,this)},this.center=function(t){return"undefined"==typeof t?this._center:(this._center=t,this)},this.zoom=function(t){return"undefined"==typeof t?this._zoom:(this._zoom=t,this)},this.joinAttr=function(t){return"undefined"==typeof t?this._joinAttr:(this._joinAttr=t,this)},this.nameAttr=function(t){return"undefined"==typeof t?this._nameAttr:(this._nameAttr=t,this)},this.onClick=function(t){return"undefined"==typeof t?this._onClick:(this._onClick=t,this)},this._style=function(t){return{weight:1,opacity:.8,color:"#000000",fillOpacity:0,className:"dashgeom dashgeom"+t.properties[lg.mapRegister._joinAttr]}},this._onClick=function(t){return t},this.map=function(){return this._map},this.init=function(){this._map=this._initMap(this._id,this._geojson,this._center,this._zoom,this._joinAttr)},this._initMap=function(t,e,i,r,n){function o(t,e){function i(t){var e="N/A";return s._currentData.forEach(function(i){i.key==t&&(e=i.value)}),e}e.on("mouseover",function(t,e){s._info.update(t.target.feature.properties[s._nameAttr]+" - "+i(t.target.feature.properties[s._joinAttr]))}),e.on("mouseout",function(t,e){s._info.update()}),e.on("click",function(t,e){s._onClick(t.target.feature)})}var s=this,a=L.tileLayer("https://data.hdx.rwlabs.org/mapbox-base-tiles/{z}/{x}/{y}.png",{}),c=L.map(this._id.substring(1),{center:i,zoom:r,layers:[a]});this._info=L.control(),this._info.onAdd=function(t){return this._div=L.DomUtil.create("div","mapinfo"),this.update(),this._div},this._info.update=function(t){this._div.innerHTML=t?t:"Hover a country for details"},this._info.addTo(c);L.geoJson(e,{style:this._style,onEachFeature:o}).addTo(c);return c},this.colorMap=function(t,e){this._currentData=t;var i=d3.max(t,function(t){return isNaN(t.value)?dn=0:dn=t.value,Number(dn)});t.forEach(function(t,r){if(null==e._valueAccessor(t.value)||isNaN(e._valueAccessor(t.value))||""===e._valueAccessor(t.value))d3.selectAll(".dashgeom"+t.key).attr("fill","#cccccc").attr("fill-opacity",.8);else{var n=e._colorAccessor(t.value,r,i);d3.selectAll(".dashgeom"+t.key).attr("fill",e._colors[n]).attr("fill-opacity",.8)}})}},column:function(t){this._dataName=t,this._labelName=t,this._scale=d3.scale.linear(),this._domain="default",this._axisLabels=!0,this._colors="default",this.label=function(t){return"undefined"==typeof t?this._labelName:(this._labelName=t,this)},this.scale=function(t){return"undefined"==typeof t?this._scale:(this._scale=t,this)},this.domain=function(t){return"undefined"==typeof t?this._domain:(this._domain=t,this)},this.axisLabels=function(t){return"undefined"==typeof t?this._axisLabels:(this._axisLabels=t,this)},this.valueAccessor=function(t){return"undefined"==typeof t?this._valueAccessor:(this._valueAccessor=t,this)},this.colorAccessor=function(t){return"undefined"==typeof t?this._colorAccessor:(this._colorAccessor=t,this)},this.labelAccessor=function(t){return"undefined"==typeof t?this._labelAccessor:(this._labelAccessor=t,this)},this.colors=function(t){return"undefined"==typeof t?this._colors:(this._colors=t,this)},this._valueAccessor=function(t,e){return t},this._colorAccessor=function(t,e,i){var r=Math.floor(t/i*5);return 5==r&&(r=4),r},this._labelAccessor=function(t,e){return isNaN(t)||null==t||""===t?t:d3.format("0,000")(t)}},grid:function(t){this._id=t,this._width=1e3,this._height=500,this._data=[],this._nameAttr="",this._joinAttr="",this._columns=[],this._properties={},this._vWhiteSpace=1,this._hWhiteSpace=1,this._properties.margin={top:120,right:50,bottom:20,left:120},lg._gridRegister.push(this),this._idnum=lg._gridRegister.length-1,this.width=function(t){return"undefined"==typeof t?this._width:(this._width=t,this)},this.height=function(t){return"undefined"==typeof t?this._height:(this._height=t,this)},this.data=function(t){return"undefined"==typeof t?this._data:(this._data=t,this)},this.margins=function(t){return"undefined"==typeof t?this._properties.margin:(this._properties.margin=t,this)},this.nameAttr=function(t){return"undefined"==typeof t?this._nameAttr:(this._nameAttr=t,this)},this.joinAttr=function(t){return"undefined"==typeof t?this._joinAttr:(this._joinAttr=t,this)},this.columns=function(t){return"undefined"==typeof t?this._columns:(this._columns=t,this)},this.vWhiteSpace=function(t){return"undefined"==typeof t?this._vWhiteSpace:(this._vWhiteSpace=t,this)},this.hWhiteSpace=function(t){return"undefined"==typeof t?this._hWhiteSpace:(this._hWhiteSpace=t,this)},this.init=function(){this.render()},this._initColumns=function(t){var e=this,i=[];return t.forEach(function(t){if("string"==typeof t){var r=new lg.column(t);r.domain([0,d3.max(e._data,function(t){return Number(t[r._dataName])})]),r._colors=lg._colors,i.push(r)}else"default"==t._domain&&t.domain([0,d3.max(e._data,function(e){return Number(e[t._dataName])})]),"default"==t._colors&&(t._colors=lg._colors),i.push(t)}),i},this.render=function(){this._render(this._id,this._data,this._nameAttr,this._joinAttr,this._initColumns(this._columns),this._width,this._height)},this._render=function(t,e,i,r,n,o,s){var a=this;this._properties.width=this._width-this._properties.margin.left-this._properties.margin.right,this._properties.height=this._height-this._properties.margin.top-this._properties.margin.bottom,this._properties.boxWidth=this._properties.width/n.length-this._hWhiteSpace,this._properties.boxHeight=this._properties.height/e.length-this._vWhiteSpace,this._properties.x=[],n.forEach(function(t,e){a._properties.x[e]=t._scale.range([0,a._properties.boxWidth]).domain(t._domain)});var c=d3.select(t).append("svg").attr("class","dashgrid dashgridid"+a._idnum).attr("width",o).attr("height",s).append("g").attr("transform","translate("+this._properties.margin.left+","+this._properties.margin.top+")"),l=d3.tip().attr("class","d3-tip").html(function(t,e){return"Click to sort"}),h=[];n.forEach(function(t,r){h[r]=d3.tip().attr("class","d3-tip").html(function(e,i){return t._labelAccessor(e.value)});var o=c.append("g").attr("class","bars");e.sort(function(t,e){return t[a._nameAttr].localeCompare(e[a._nameAttr])});var s=[];e.forEach(function(e,i){var r={};r.pos=e.pos,r.join=e[a._joinAttr],r.value=e[t._dataName],s.push(r)});var u=d3.max(s,function(e){return Number(t._valueAccessor(e.value))});o.selectAll("rect").data(s).enter().append("rect").attr("class","bars"+r+"id"+a._idnum).attr("x",function(t,e){return a._properties.boxWidth*r+r*a._hWhiteSpace}).attr("y",function(t,e){return a._properties.boxHeight*e+e*a._vWhiteSpace}).attr("width",function(e){return null==t._valueAccessor(e.value)||isNaN(t._valueAccessor(e.value))||""===t._valueAccessor(e.value)?a._properties.boxWidth:a._properties.x[r](t._valueAccessor(e.value))}).attr("height",a._properties.boxHeight).attr("fill",function(e,i){if(null==t._valueAccessor(e.value)||isNaN(t._valueAccessor(e.value))||""===t._valueAccessor(e.value))return"#cccccc";var r=t._colorAccessor(e.value,i,u);return t._colors[r]});var d=a._properties.boxWidth*r+r*a._hWhiteSpace,o=c.append("g"),p=o.append("text").text(t._labelName).attr("x",0).attr("y",0).style("text-anchor","front").attr("transform","translate("+(d+a._properties.boxWidth/2-10)+",-10) rotate(-65)").attr("class",function(t){return"sortLabel sortLabel"+r+"id"+a._idnum}).on("click",function(){a._update(e,n,t,i)});p.on("mouseover",function(e,i){-1==lg._selectedBar&&(d3.selectAll(".maxLabel").attr("opacity",0),d3.selectAll(".sortLabel").style("font-weight","normal"),d3.selectAll(".maxLabel"+r+"id"+a._idnum).attr("opacity",1),d3.selectAll(".sortLabel"+r+"id"+a._idnum).style("font-weight","bold"),lg.mapRegister.colorMap(f,t))}),d3.selectAll(".sortLabel").call(l),t._axisLabels&&(o.append("text").text(t._labelAccessor(t._domain[t._domain.length-1])).attr("x",a._properties.boxWidth-5).attr("y",a._properties.height+10+a._vWhiteSpace).style("text-anchor","front").attr("transform","translate("+d+",0)").attr("opacity",0).attr("class",function(t){return"maxLabel maxLabel"+r+"id"+a._idnum}),o.append("text").text(t._labelAccessor(t._domain[0])).attr("x",-5).attr("y",a._properties.height+10+a._vWhiteSpace).style("text-anchor","front").attr("transform","translate("+d+",0)").attr("opacity",0).attr("class",function(t){return"maxLabel maxLabel"+r+"id"+a._idnum})),o.append("line").attr("x1",a._properties.boxWidth*(r+1)+r*a._hWhiteSpace).attr("y1",-a._hWhiteSpace/2).attr("x2",a._properties.boxWidth*(r+1)+r*a._hWhiteSpace).attr("y2",a._properties.height-a._vWhiteSpace/2).attr("opacity",0).attr("class",function(t){return"maxLabel maxLabel"+r+"id"+a._idnum}).attr("stroke-width",1).attr("stroke","#ddd"),o.append("line").attr("x1",a._properties.boxWidth*r+r*a._hWhiteSpace).attr("y1",-a._hWhiteSpace/2).attr("x2",a._properties.boxWidth*r+r*a._hWhiteSpace).attr("y2",a._properties.height-a._vWhiteSpace/2).attr("opacity",0).attr("class",function(t){return"maxLabel maxLabel"+r+"id"+a._idnum}).attr("stroke-width",1).attr("stroke","#ddd");var o=c.append("g"),_=o.selectAll("rect").data(s).enter().append("rect").attr("class","selectbars"+r+"id"+a._idnum).attr("x",function(t,e){return a._properties.boxWidth*r+r*a._hWhiteSpace}).attr("y",function(t,e){return a._properties.boxHeight*e+e*a._vWhiteSpace}).attr("width",function(t){return a._properties.boxWidth+a._hWhiteSpace}).attr("height",a._properties.boxHeight+a._vWhiteSpace).attr("opacity",0);d3.selectAll(".selectbars"+r+"id"+a._idnum).call(h[r]);var f=[];s.forEach(function(t){f.push({key:t.join,value:t.value})}),_.on("mouseover",function(e,i){d3.selectAll(".dashgeom"+e.join).attr("stroke-width",3),d3.selectAll(".horLine"+i+"id"+a._idnum).attr("opacity",1),-1==lg._selectedBar&&(d3.selectAll(".maxLabel").attr("opacity",0),d3.selectAll(".sortLabel").style("font-weight","normal"),d3.selectAll(".maxLabel"+r+"id"+a._idnum).attr("opacity",1),d3.selectAll(".sortLabel"+r+"id"+a._idnum).style("font-weight","bold"),lg.mapRegister.colorMap(f,t))}).on("mouseout",function(t,e){d3.selectAll(".horLine"+e+"id"+a._idnum).attr("opacity",0),d3.selectAll(".dashgeom"+t.join).attr("stroke-width",1)}).on("click",function(e,i){lg._selectedBar==r?lg._selectedBar=-1:(d3.selectAll(".maxLabel"+lg._selectedBar+"id"+a._idnum).attr("opacity",0),d3.selectAll(".sortLabel"+lg._selectedBar+"id"+a._idnum).style("font-weight","normal"),lg._selectedBar=r,d3.selectAll(".maxLabel"+lg._selectedBar+"id"+a._idnum).attr("opacity",1),d3.selectAll(".sortLabel"+lg._selectedBar+"id"+a._idnum).style("font-weight","bold"),lg.mapRegister.colorMap(f,t))}),d3.selectAll(".selectbars"+r+"id"+a._idnum).on("mouseover.something",h[r].show).on("mouseout.something",h[r].hide),d3.selectAll(".sortLabel").on("mouseover.something",l.show).on("mouseout.something",l.hide)});var u=c.append("g");u.selectAll("line").data(e).enter().append("line").attr("x1",-a._properties.margin.left).attr("y1",function(t,e){return a._properties.boxHeight*e+(e-.5)*a._vWhiteSpace}).attr("x2",a._properties.width-a._hWhiteSpace).attr("y2",function(t,e){return a._properties.boxHeight*e+(e-.5)*a._vWhiteSpace}).attr("opacity",0).attr("class",function(t,e){return"horLine"+e+"id"+a._idnum+" horLineTop horLineTopid"+a._idnum}).attr("stroke-width",1).attr("stroke","#ddd");var u=c.append("g");u.selectAll("line").data(e).enter().append("line").attr("x1",-a._properties.margin.left).attr("y1",function(t,e){return a._properties.boxHeight*(e+1)+(e+.5)*a._vWhiteSpace}).attr("x2",a._properties.width-a._hWhiteSpace).attr("y2",function(t,e){return a._properties.boxHeight*(e+1)+(e+.5)*a._vWhiteSpace}).attr("opacity",0).attr("class",function(t,e){return"horLine"+e+"id"+a._idnum+" horLineBot horLineBotid"+a._idnum}).attr("stroke-width",1).attr("stroke","#ddd"),c.append("g").selectAll("text").data(e).enter().append("text").text(function(t){return t[i]}).attr("x",function(t){return 5-a._properties.margin.left}).attr("y",function(t,e){return a._properties.boxHeight*(e+.5)+e*a._vWhiteSpace}).attr("class","nameLabels nameLabelsid"+a._idnum)},this._update=function(t,e,i,r){var n=this;t.sort(function(t,e){return null==i._valueAccessor(t[i._dataName])||isNaN(i._valueAccessor(t[i._dataName]))||""===i._valueAccessor(t[i._dataName])?1:null==i._valueAccessor(e[i._dataName])||isNaN(i._valueAccessor(e[i._dataName]))||""===i._valueAccessor(e[i._dataName])?-1:parseFloat(i._valueAccessor(e[i._dataName]))-parseFloat(i._valueAccessor(t[i._dataName]))}),t.forEach(function(t,e){t.pos=e}),t.sort(function(t,e){return t[n._nameAttr].localeCompare(e[n._nameAttr])});var o=[];t.forEach(function(t,e){var i={};i.pos=t.pos,o.push(i)}),e.forEach(function(t,e){d3.selectAll(".bars"+e+"id"+n._idnum).data(o).transition().duration(750).attr("x",function(t,i){return n._properties.boxWidth*e+e*n._hWhiteSpace}).attr("y",function(t,e){return n._properties.boxHeight*t.pos+t.pos*n._vWhiteSpace}),d3.selectAll(".selectbars"+e+"id"+n._idnum).data(o).transition().duration(750).attr("x",function(t,i){return n._properties.boxWidth*e+e*n._hWhiteSpace}).attr("y",function(t,e){return n._properties.boxHeight*t.pos+t.pos*n._vWhiteSpace})}),d3.selectAll(".horLineTopid"+n._idnum).attr("y1",function(t,e){return console.log("top:"+t.pos),n._properties.boxHeight*t.pos+(t.pos-.5)*n._vWhiteSpace}).attr("y2",function(t,e){return n._properties.boxHeight*t.pos+(t.pos-.5)*n._vWhiteSpace}),d3.selectAll(".horLineBotid"+n._idnum).attr("y1",function(t,e){return console.log("bottom"+t.pos),n._properties.boxHeight*(t.pos+1)+(t.pos+.5)*n._vWhiteSpace}).attr("y2",function(t,e){return n._properties.boxHeight*(t.pos+1)+(t.pos+.5)*n._vWhiteSpace}),d3.selectAll(".nameLabelsid"+n._idnum).transition().duration(750).attr("y",function(t){return n._properties.boxHeight*(t.pos+.5)+t.pos*n._vWhiteSpace})}}};d3.tip=function(){function t(t){v=p(t),x=v.createSVGPoint(),document.body.appendChild(y)}function e(){return"n"}function i(){return[0,0]}function r(){return" "}function n(){var t=_();return{top:t.n.y-y.offsetHeight,left:t.n.x-y.offsetWidth/2}}function o(){var t=_();return{top:t.s.y,left:t.s.x-y.offsetWidth/2}}function s(){var t=_();return{top:t.e.y-y.offsetHeight/2,left:t.e.x}}function a(){var t=_();return{top:t.w.y-y.offsetHeight/2,left:t.w.x-y.offsetWidth}}function c(){var t=_();return{top:t.nw.y-y.offsetHeight,left:t.nw.x-y.offsetWidth}}function l(){var t=_();return{top:t.ne.y-y.offsetHeight,left:t.ne.x}}function h(){var t=_();return{top:t.sw.y,left:t.sw.x-y.offsetWidth}}function u(){var t=_();return{top:t.se.y,left:t.e.x}}function d(){var t=document.createElement("div");return t.style.position="absolute",t.style.display="none",t.style.boxSizing="border-box",t}function p(t){return t=t.node(),"svg"==t.tagName.toLowerCase()?t:t.ownerSVGElement}function _(){var t=d3.event.target,e={},i=t.getScreenCTM(),r=t.getBBox(),n=r.width,o=r.height,s=r.x,a=r.y,c=document.body.scrollTop,l=document.body.scrollLeft;return document.documentElement&&document.documentElement.scrollTop&&(c=document.documentElement.scrollTop,l=document.documentElement.scrollLeft),x.x=s+l,x.y=a+c,e.nw=x.matrixTransform(i),x.x+=n,e.ne=x.matrixTransform(i),x.y+=o,e.se=x.matrixTransform(i),x.x-=n,e.sw=x.matrixTransform(i),x.y-=o/2,e.w=x.matrixTransform(i),x.x+=n,e.e=x.matrixTransform(i),x.x-=n/2,x.y-=o/2,e.n=x.matrixTransform(i),x.y+=o,e.s=x.matrixTransform(i),e}var f=e,m=i,g=r,y=d(),v=null,x=null;t.show=function(){var e,i=g.apply(this,arguments),r=m.apply(this,arguments),n=f.apply(this,arguments),o=d3.select(y),s=0;for(o.html(i).style("display","block");s--;)o.classed(A[s],!1);return e=b.get(n).apply(this),o.classed(n,!0).style({top:e.top+r[0]+"px",left:e.left+r[1]+"px"}),t},t.hide=function(){return y.style.display="none",y.innerHTML="",t},t.attr=function(e,i){return arguments.length<2?d3.select(y).attr(e):(d3.select(y).attr(e,i),t)},t.style=function(e,i){return arguments.length<2?d3.select(y).style(e):(d3.select(y).style(e,i),t)},t.direction=function(e){return arguments.length?(f=null==e?e:d3.functor(e),t):f},t.offset=function(e){return arguments.length?(m=null==e?e:d3.functor(e),t):m},t.html=function(e){return arguments.length?(g=null==e?e:d3.functor(e),t):g};var b=d3.map({n:n,s:o,e:s,w:a,nw:c,ne:l,sw:h,se:u}),A=b.keys();return t};